global:
  security: 
    allowInsecureImages: true # Required for using ECR images with Bitnami charts
  storageClass: "do-block-storage" # Updated from standard for DigitalOcean
  postgresql:
    auth:
      database: "defaultdb"
      username: "taxi_user"
      password: "taxi_password"
      postgresPassword: "admin_password"
      replicationPassword: "repl_password"


image:
  registry: public.ecr.aws
  repository: bitnami/postgresql
  tag: "17.2.0"

# postgresql:
  # replicaCount: 2 # This was nested incorrectly for direct chart usage
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

pgpool:
  enabled: false # We use PgBouncer defined below (or chart specific) but Bitnami HA uses PgPool usually. Wait, standard HA chart uses PgPool-II by default for load balancing and split logic. User asked for PgBouncer.
  # Bitnami 'postgresql-ha' uses PgPool-II. 
  # Bitnami 'postgresql' (standalone) allows pgbouncer sidecar.
  # The User specifically asked for "PG BOUNCER".
  # Bitnami 'postgresql-ha' chart is strictly PgPool-II based. 
  # To get PgBouncer + HA + Patroni/Repmgr is complex.
  # CORRECT APPROACH: The "postgresql-ha" chart uses PgPool. I can try to simply use PgPool which fulfills the "Shared Volume + 3 Replicas + Connection Pooling" requirement, effectively replacing PgBouncer. 
  # OR I can use the standard 'postgresql' chart with `architecture: replication` and `pgbouncer.enabled: true`. This is likely what they want: "Replication + PgBouncer".
  
  # Decision: I will use bitnami/postgresql with architecture: replication.
  
architecture: replication
replication:
  applicationName: "silver_taxi"
  readReplicas: 1 # Reduced from 2

auth:
  database: "defaultdb"
  username: "taxi_user"
  password: "taxi_password"
  postgresPassword: "admin_password"
  replicationPassword: "repl_password"

primary:
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      cpu: 100m
      memory: 150Mi
  service:
    type: LoadBalancer

readReplicas:
  replicaCount: 1 # Reduced from 2
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      cpu: 100m
      memory: 150Mi

# Enable PgBouncer
pgbouncer:
  enabled: true
  image:
    tag: "1.23.1" # Using latest stable as 17.7.0 is not a valid PgBouncer version
  replicas: 1 # Reduced from 2
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
